<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.TypeChecking.DeadCode</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier">eliminateDeadCode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">All</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MapS</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Names.html"><span class="hs-identifier">Agda.Syntax.Internal.Names</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html"><span class="hs-identifier">Agda.Utils.WithDefault</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | Run before serialisation to remove any definitions and</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- meta-variables that are not reachable from the module's public</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- interface.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- Things that are reachable only from warnings are removed.</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier hs-type">eliminateDeadCode</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinThings"><span class="hs-identifier hs-type">BuiltinThings</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimFun"><span class="hs-identifier hs-type">PrimFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LocalMetaStore"><span class="hs-identifier hs-type">LocalMetaStore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RemoteMetaStore"><span class="hs-identifier hs-type">RemoteMetaStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span id="eliminateDeadCode"><span class="annot"><span class="annottext">eliminateDeadCode :: BuiltinThings PrimFun
-&gt; HashMap QName [LocalDisplayForm]
-&gt; Signature
-&gt; LocalMetaStore
-&gt; TCM
     (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
</span><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier hs-var hs-var">eliminateDeadCode</span></a></span></span><span> </span><span id="local-6989586621681118408"><span class="annot"><span class="annottext">BuiltinThings PrimFun
</span><a href="#local-6989586621681118408"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681118407"><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118407"><span class="hs-identifier hs-var">disp</span></a></span></span><span> </span><span id="local-6989586621681118406"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681118406"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621681118405"><span class="annot"><span class="annottext">LocalMetaStore
</span><a href="#local-6989586621681118405"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCM
     (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
-&gt; TCM
     (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#DeadCode"><span class="hs-identifier hs-var">Bench.DeadCode</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
 -&gt; TCM
      (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore))
-&gt; TCM
     (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
-&gt; TCM
     (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-44"></span><span>  </span><span id="local-6989586621681118402"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681118402"><span class="hs-identifier hs-var">patsyn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-var">getPatternSyns</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span id="local-6989586621681118400"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118400"><span class="hs-identifier hs-var">public</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName) -&gt; Set AbstractName -&gt; Set QName
forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(Set AbstractName -&gt; Set QName)
-&gt; (ScopeInfo -&gt; Set AbstractName) -&gt; ScopeInfo -&gt; Set QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Set AbstractName
</span><a href="Agda.Syntax.Scope.Base.html#publicNames"><span class="hs-identifier hs-var">publicNames</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; Set QName)
-&gt; TCMT IO ScopeInfo -&gt; TCMT IO (Set QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span id="local-6989586621681118393"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681118393"><span class="hs-identifier hs-var">save</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WithDefault 'False -&gt; Bool
forall (b :: Bool). KnownBool b =&gt; WithDefault b -&gt; Bool
</span><a href="Agda.Utils.WithDefault.html#collapseDefault"><span class="hs-identifier hs-var">collapseDefault</span></a></span><span> </span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; Bool)
-&gt; (PragmaOptions -&gt; WithDefault 'False) -&gt; PragmaOptions -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; WithDefault 'False
</span><a href="Agda.Interaction.Options.Base.html#optSaveMetas"><span class="hs-identifier hs-var">optSaveMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span id="local-6989586621681118389"><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118389"><span class="hs-identifier hs-var">defs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681118393"><span class="hs-identifier hs-var">save</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; TCMT IO (HashMap QName Definition)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Definition)
-&gt; HashMap QName Definition -&gt; TCMT IO (HashMap QName Definition)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681118406"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
-&gt; Lens' (HashMap QName Definition) Signature
-&gt; HashMap QName Definition
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (HashMap QName Definition) Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-comment">-- #2921: Eliminating definitions with attached COMPILE pragmas results in</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-comment">-- the pragmas not being checked. Simple solution: don't eliminate these.</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681118382"><span class="annot"><span class="annottext">hasCompilePragma :: Set QName
</span><a href="#local-6989586621681118382"><span class="hs-identifier hs-var hs-var">hasCompilePragma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><span class="annottext">[QName] -&gt; Set QName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; Set QName)
-&gt; (HashMap QName Definition -&gt; [QName])
-&gt; HashMap QName Definition
-&gt; Set QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; [QName]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HMap.keys</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; [QName])
-&gt; (HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; HashMap QName Definition
-&gt; [QName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="annottext">(Definition -&gt; Bool)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Definition -&gt; Bool) -&gt; Definition -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map [Char] [CompilerPragma] -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">MapS.null</span></span><span> </span><span class="annot"><span class="annottext">(Map [Char] [CompilerPragma] -&gt; Bool)
-&gt; (Definition -&gt; Map [Char] [CompilerPragma])
-&gt; Definition
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Map [Char] [CompilerPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#defCompiledRep"><span class="hs-identifier hs-var">defCompiledRep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; Set QName)
-&gt; HashMap QName Definition -&gt; Set QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118389"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-54"></span><span>      </span><span id="local-6989586621681118375"><span class="annot"><span class="annottext">rootNames :: Set QName
</span><a href="#local-6989586621681118375"><span class="hs-identifier hs-var hs-var">rootNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118400"><span class="hs-identifier hs-var">public</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118382"><span class="hs-identifier hs-var">hasCompilePragma</span></a></span><span>
</span><span id="line-55"></span><span>      </span><span id="local-6989586621681118373"><span class="annot"><span class="annottext">rootMetas :: Set MetaId
</span><a href="#local-6989586621681118373"><span class="hs-identifier hs-var hs-var">rootMetas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681118393"><span class="hs-identifier hs-var">save</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Set MetaId
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(BuiltinThings PrimFun, Sections, RewriteRuleMap,
 HashMap QName [LocalDisplayForm])
-&gt; Set MetaId
forall a m. (NamesIn a, Collection MetaId m) =&gt; a -&gt; m
</span><a href="Agda.Syntax.Internal.Names.html#metasIn"><span class="hs-identifier hs-var">metasIn</span></a></span><span>
</span><span id="line-57"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">BuiltinThings PrimFun
</span><a href="#local-6989586621681118408"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-58"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681118406"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Lens' Sections Signature -&gt; Sections
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' Sections Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#sigSections"><span class="hs-identifier hs-var">sigSections</span></a></span><span>
</span><span id="line-59"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681118406"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Lens' RewriteRuleMap Signature -&gt; RewriteRuleMap
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' RewriteRuleMap Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#sigRewriteRules"><span class="hs-identifier hs-var">sigRewriteRules</span></a></span><span>
</span><span id="line-60"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; [LocalDisplayForm] -&gt; Bool)
-&gt; HashMap QName [LocalDisplayForm]
-&gt; HashMap QName [LocalDisplayForm]
forall k v. (k -&gt; v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681118363"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118363"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">[LocalDisplayForm]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118363"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118375"><span class="hs-identifier hs-var">rootNames</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118407"><span class="hs-identifier hs-var">disp</span></a></span><span>
</span><span id="line-61"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681118361"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118361"><span class="hs-identifier hs-var">rns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681118360"><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118360"><span class="hs-identifier hs-var">rms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="annottext">(Set QName, Set MetaId)
-&gt; PatternSynDefns
-&gt; HashMap QName [LocalDisplayForm]
-&gt; HashMap QName Definition
-&gt; LocalMetaStore
-&gt; (Set QName, Set MetaId)
</span><a href="Agda.TypeChecking.DeadCode.html#reachableFrom"><span class="hs-identifier hs-var">reachableFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118375"><span class="hs-identifier hs-var">rootNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118373"><span class="hs-identifier hs-var">rootMetas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681118402"><span class="hs-identifier hs-var">patsyn</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118407"><span class="hs-identifier hs-var">disp</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118389"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">LocalMetaStore
</span><a href="#local-6989586621681118405"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-64"></span><span>      </span><span id="local-6989586621681118358"><span class="annot"><span class="annottext">dead :: Set QName
</span><a href="#local-6989586621681118358"><span class="hs-identifier hs-var hs-var">dead</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Set QName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; [QName]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HMap.keys</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118389"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118361"><span class="hs-identifier hs-var">rns</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span id="local-6989586621681118356"><span class="annot"><span class="annottext">valid :: LocalDisplayForm -&gt; Bool
</span><a href="#local-6989586621681118356"><span class="hs-identifier hs-var hs-var">valid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">All -&gt; Bool
</span><span class="hs-identifier hs-var">getAll</span></span><span> </span><span class="annot"><span class="annottext">(All -&gt; Bool)
-&gt; (LocalDisplayForm -&gt; All) -&gt; LocalDisplayForm -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; All) -&gt; LocalDisplayForm -&gt; All
forall a m. (NamesIn a, Monoid m) =&gt; (QName -&gt; m) -&gt; a -&gt; m
</span><a href="Agda.Syntax.Internal.Names.html#namesIn%27"><span class="hs-identifier hs-var">namesIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; All
</span><span class="hs-identifier hs-var">All</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; All) -&gt; (QName -&gt; Bool) -&gt; QName -&gt; All
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118358"><span class="hs-identifier hs-var">dead</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- no used name is dead</span><span>
</span><span id="line-66"></span><span>      </span><span id="local-6989586621681118351"><span class="annot"><span class="annottext">defs' :: HashMap QName Definition
</span><a href="#local-6989586621681118351"><span class="hs-identifier hs-var hs-var">defs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Definition)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HMap.map</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681118349"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681118349"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681118349"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">defDisplay :: [LocalDisplayForm]
</span><a href="Agda.TypeChecking.Monad.Base.html#defDisplay"><span class="hs-identifier hs-var">defDisplay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocalDisplayForm -&gt; Bool)
-&gt; [LocalDisplayForm] -&gt; [LocalDisplayForm]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">LocalDisplayForm -&gt; Bool
</span><a href="#local-6989586621681118356"><span class="hs-identifier hs-var">valid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; [LocalDisplayForm]
</span><a href="Agda.TypeChecking.Monad.Base.html#defDisplay"><span class="hs-identifier hs-var">defDisplay</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681118349"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>            </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Definition -&gt; Bool)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall k v. (k -&gt; v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681118347"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118347"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Definition
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118347"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118361"><span class="hs-identifier hs-var">rns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118389"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-68"></span><span>      </span><span id="local-6989586621681118346"><span class="annot"><span class="annottext">disp' :: HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118346"><span class="hs-identifier hs-var hs-var">disp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([LocalDisplayForm] -&gt; Bool)
-&gt; HashMap QName [LocalDisplayForm]
-&gt; HashMap QName [LocalDisplayForm]
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([LocalDisplayForm] -&gt; Bool) -&gt; [LocalDisplayForm] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[LocalDisplayForm] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashMap QName [LocalDisplayForm]
 -&gt; HashMap QName [LocalDisplayForm])
-&gt; HashMap QName [LocalDisplayForm]
-&gt; HashMap QName [LocalDisplayForm]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([LocalDisplayForm] -&gt; [LocalDisplayForm])
-&gt; HashMap QName [LocalDisplayForm]
-&gt; HashMap QName [LocalDisplayForm]
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HMap.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocalDisplayForm -&gt; Bool)
-&gt; [LocalDisplayForm] -&gt; [LocalDisplayForm]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">LocalDisplayForm -&gt; Bool
</span><a href="#local-6989586621681118356"><span class="hs-identifier hs-var">valid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118407"><span class="hs-identifier hs-var">disp</span></a></span><span>
</span><span id="line-69"></span><span>      </span><span id="local-6989586621681118344"><span class="annot"><span class="annottext">ms' :: RemoteMetaStore
</span><a href="#local-6989586621681118344"><span class="hs-identifier hs-var hs-var">ms'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(MetaId, RemoteMetaVariable)] -&gt; RemoteMetaStore
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(MetaId, RemoteMetaVariable)] -&gt; RemoteMetaStore)
-&gt; [(MetaId, RemoteMetaVariable)] -&gt; RemoteMetaStore
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-70"></span><span>              </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; Maybe (MetaId, RemoteMetaVariable))
-&gt; [(MetaId, MetaVariable)] -&gt; [(MetaId, RemoteMetaVariable)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-71"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681118341"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681118341"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681118340"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118340"><span class="hs-identifier hs-var">mv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Set MetaId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681118341"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118360"><span class="hs-identifier hs-var">rms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (MetaId, RemoteMetaVariable)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-74"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(MetaId, RemoteMetaVariable) -&gt; Maybe (MetaId, RemoteMetaVariable)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681118341"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; RemoteMetaVariable
</span><a href="Agda.TypeChecking.DeadCode.html#remoteMetaVariable"><span class="hs-identifier hs-var">remoteMetaVariable</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118340"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(MetaId, MetaVariable)] -&gt; [(MetaId, RemoteMetaVariable)])
-&gt; [(MetaId, MetaVariable)] -&gt; [(MetaId, RemoteMetaVariable)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-75"></span><span>              </span><span class="annot"><span class="annottext">LocalMetaStore -&gt; [(MetaId, MetaVariable)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">MapS.toList</span></span><span> </span><span class="annot"><span class="annottext">LocalMetaStore
</span><a href="#local-6989586621681118405"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-comment">-- The hashmaps are forced to WHNF to ensure that the computations</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- are billed to the right account.</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621681118337"><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118337"><span class="hs-identifier hs-var">disp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (HashMap QName [LocalDisplayForm])
-&gt; TCMT IO (HashMap QName [LocalDisplayForm])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (HashMap QName [LocalDisplayForm])
 -&gt; TCMT IO (HashMap QName [LocalDisplayForm]))
-&gt; IO (HashMap QName [LocalDisplayForm])
-&gt; TCMT IO (HashMap QName [LocalDisplayForm])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
-&gt; IO (HashMap QName [LocalDisplayForm])
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">E.evaluate</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118346"><span class="hs-identifier hs-var">disp'</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621681118334"><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118334"><span class="hs-identifier hs-var">defs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (HashMap QName Definition) -&gt; TCMT IO (HashMap QName Definition)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (HashMap QName Definition)
 -&gt; TCMT IO (HashMap QName Definition))
-&gt; IO (HashMap QName Definition)
-&gt; TCMT IO (HashMap QName Definition)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; IO (HashMap QName Definition)
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">E.evaluate</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118351"><span class="hs-identifier hs-var">defs'</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621681118333"><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681118333"><span class="hs-identifier hs-var">ms'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RemoteMetaStore -&gt; TCMT IO RemoteMetaStore
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO RemoteMetaStore -&gt; TCMT IO RemoteMetaStore)
-&gt; IO RemoteMetaStore -&gt; TCMT IO RemoteMetaStore
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore -&gt; IO RemoteMetaStore
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">E.evaluate</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681118344"><span class="hs-identifier hs-var">ms'</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.dead&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO ()) -&gt; [Char] -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Removed &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><span class="hs-identifier hs-var">HMap.size</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118389"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><span class="hs-identifier hs-var">HMap.size</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118334"><span class="hs-identifier hs-var">defs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; unused definitions and &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalMetaStore -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">MapS.size</span></span><span> </span><span class="annot"><span class="annottext">LocalMetaStore
</span><a href="#local-6989586621681118405"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><span class="hs-identifier hs-var">HMap.size</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681118333"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; unused meta-variables.&quot;</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">(HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
-&gt; TCM
     (HashMap QName [LocalDisplayForm], Signature, RemoteMetaStore)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118337"><span class="hs-identifier hs-var">disp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Lens' (HashMap QName Definition) Signature
-&gt; LensSet (HashMap QName Definition) Signature
forall i o. Lens' i o -&gt; LensSet i o
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (HashMap QName Definition) Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118334"><span class="hs-identifier hs-var">defs'</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681118406"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621681118333"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#reachableFrom"><span class="hs-identifier hs-type">reachableFrom</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ Roots.</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">A.PatternSynDefns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LocalMetaStore"><span class="hs-identifier hs-type">LocalMetaStore</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span id="reachableFrom"><span class="annot"><span class="annottext">reachableFrom :: (Set QName, Set MetaId)
-&gt; PatternSynDefns
-&gt; HashMap QName [LocalDisplayForm]
-&gt; HashMap QName Definition
-&gt; LocalMetaStore
-&gt; (Set QName, Set MetaId)
</span><a href="Agda.TypeChecking.DeadCode.html#reachableFrom"><span class="hs-identifier hs-var hs-var">reachableFrom</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681118324"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118324"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681118323"><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118323"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681118322"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681118322"><span class="hs-identifier hs-var">psyns</span></a></span></span><span> </span><span id="local-6989586621681118321"><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118321"><span class="hs-identifier hs-var">disp</span></a></span></span><span> </span><span id="local-6989586621681118320"><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118320"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span id="local-6989586621681118319"><span class="annot"><span class="annottext">LocalMetaStore
</span><a href="#local-6989586621681118319"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">(Set QName, Set MetaId)
-&gt; [Either QName MetaId] -&gt; (Set QName, Set MetaId)
</span><a href="#local-6989586621681118318"><span class="hs-identifier hs-var">follow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118324"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118323"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; Either QName MetaId) -&gt; [QName] -&gt; [Either QName MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Either QName MetaId
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118324"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Either QName MetaId]
-&gt; [Either QName MetaId] -&gt; [Either QName MetaId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; Either QName MetaId)
-&gt; [MetaId] -&gt; [Either QName MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Either QName MetaId
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set MetaId -&gt; [MetaId]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118323"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621681118318"><span class="annot"><span class="annottext">follow :: (Set QName, Set MetaId)
-&gt; [Either QName MetaId] -&gt; (Set QName, Set MetaId)
</span><a href="#local-6989586621681118318"><span class="hs-identifier hs-var hs-var">follow</span></a></span></span><span> </span><span id="local-6989586621681118316"><span class="annot"><span class="annottext">(Set QName, Set MetaId)
</span><a href="#local-6989586621681118316"><span class="hs-identifier hs-var">seen</span></a></span></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set QName, Set MetaId)
</span><a href="#local-6989586621681118316"><span class="hs-identifier hs-var">seen</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="#local-6989586621681118318"><span class="hs-identifier hs-var">follow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681118315"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118315"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681118314"><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118314"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681118313"><span class="annot"><span class="annottext">Either QName MetaId
</span><a href="#local-6989586621681118313"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681118312"><span class="annot"><span class="annottext">[Either QName MetaId]
</span><a href="#local-6989586621681118312"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">(Set QName, Set MetaId)
-&gt; [Either QName MetaId] -&gt; (Set QName, Set MetaId)
</span><a href="#local-6989586621681118318"><span class="hs-identifier hs-var">follow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118311"><span class="hs-identifier hs-var">ids''</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118315"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set MetaId -&gt; Set MetaId -&gt; Set MetaId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118310"><span class="hs-identifier hs-var">ms''</span></a></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118314"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; Either QName MetaId) -&gt; [QName] -&gt; [Either QName MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Either QName MetaId
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118311"><span class="hs-identifier hs-var">ids''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Either QName MetaId]
-&gt; [Either QName MetaId] -&gt; [Either QName MetaId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-99"></span><span>       </span><span class="annot"><span class="annottext">(MetaId -&gt; Either QName MetaId)
-&gt; [MetaId] -&gt; [Either QName MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Either QName MetaId
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set MetaId -&gt; [MetaId]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118310"><span class="hs-identifier hs-var">ms''</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">[Either QName MetaId]
-&gt; [Either QName MetaId] -&gt; [Either QName MetaId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-100"></span><span>       </span><span class="annot"><span class="annottext">[Either QName MetaId]
</span><a href="#local-6989586621681118312"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621681118311"><span class="annot"><span class="annottext">ids'' :: Set QName
</span><a href="#local-6989586621681118311"><span class="hs-identifier hs-var hs-var">ids''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118309"><span class="hs-identifier hs-var">ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118315"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621681118310"><span class="annot"><span class="annottext">ms'' :: Set MetaId
</span><a href="#local-6989586621681118310"><span class="hs-identifier hs-var hs-var">ms''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118308"><span class="hs-identifier hs-var">ms'</span></a></span><span>  </span><span class="annot"><span class="annottext">Set MetaId -&gt; Set MetaId -&gt; Set MetaId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118314"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681118309"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681118309"><span class="hs-identifier hs-var">ids'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681118308"><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621681118308"><span class="hs-identifier hs-var">ms'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QName MetaId
</span><a href="#local-6989586621681118313"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681118307"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118307"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">(Maybe Definition, Maybe PSyn, Maybe [LocalDisplayForm])
-&gt; (Set QName, Set MetaId)
forall a m1 m2.
(NamesIn a, Collection QName m1, Collection MetaId m2) =&gt;
a -&gt; (m1, m2)
</span><a href="Agda.Syntax.Internal.Names.html#namesAndMetasIn"><span class="hs-identifier hs-var">namesAndMetasIn</span></a></span><span>
</span><span id="line-108"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">QName -&gt; HashMap QName Definition -&gt; Maybe Definition
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118307"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681118320"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-109"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PatternSynDefn -&gt; PSyn
</span><a href="Agda.Syntax.Internal.Names.html#PSyn"><span class="hs-identifier hs-var">PSyn</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSynDefn -&gt; PSyn) -&gt; Maybe PatternSynDefn -&gt; Maybe PSyn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; PatternSynDefns -&gt; Maybe PatternSynDefn
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">MapS.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118307"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681118322"><span class="hs-identifier hs-var">psyns</span></a></span><span>
</span><span id="line-110"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; HashMap QName [LocalDisplayForm] -&gt; Maybe [LocalDisplayForm]
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681118307"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName [LocalDisplayForm]
</span><a href="#local-6989586621681118321"><span class="hs-identifier hs-var">disp</span></a></span><span>
</span><span id="line-111"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681118302"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681118302"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; LocalMetaStore -&gt; Maybe MetaVariable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">MapS.lookup</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621681118302"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">LocalMetaStore
</span><a href="#local-6989586621681118319"><span class="hs-identifier hs-var">insts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">Maybe MetaVariable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set MetaId
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681118301"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118301"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; (Set QName, Set MetaId)
forall a m1 m2.
(NamesIn a, Collection QName m1, Collection MetaId m2) =&gt;
a -&gt; (m1, m2)
</span><a href="Agda.Syntax.Internal.Names.html#namesAndMetasIn"><span class="hs-identifier hs-var">namesAndMetasIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instantiation -&gt; Term
</span><a href="Agda.TypeChecking.Monad.Base.html#instBody"><span class="hs-identifier hs-var">instBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaVariable -&gt; Instantiation
</span><a href="Agda.TypeChecking.DeadCode.html#theInstantiation"><span class="hs-identifier hs-var">theInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118301"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Returns the instantiation.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Precondition: The instantiation must be of the form @'InstV' inst@.</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#theInstantiation"><span class="hs-identifier hs-type">theInstantiation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MetaVariable"><span class="hs-identifier hs-type">MetaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Instantiation"><span class="hs-identifier hs-type">Instantiation</span></a></span><span>
</span><span id="line-121"></span><span id="theInstantiation"><span class="annot"><span class="annottext">theInstantiation :: MetaVariable -&gt; Instantiation
</span><a href="Agda.TypeChecking.DeadCode.html#theInstantiation"><span class="hs-identifier hs-var hs-var">theInstantiation</span></a></span></span><span> </span><span id="local-6989586621681118298"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118298"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118298"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InstV"><span class="hs-identifier hs-type">InstV</span></a></span><span> </span><span id="local-6989586621681118295"><span class="annot"><span class="annottext">Instantiation
</span><a href="#local-6989586621681118295"><span class="hs-identifier hs-var">inst</span></a></span></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instantiation
</span><a href="#local-6989586621681118295"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instantiation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OpenInstance"><span class="hs-identifier hs-type">OpenInstance</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instantiation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BlockedConst"><span class="hs-identifier hs-type">BlockedConst</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instantiation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PostponedTypeCheckingProblem"><span class="hs-identifier hs-type">PostponedTypeCheckingProblem</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instantiation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Converts from 'MetaVariable' to 'RemoteMetaVariable'.</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- Precondition: The instantiation must be of the form @'InstV' inst@.</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#remoteMetaVariable"><span class="hs-identifier hs-type">remoteMetaVariable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MetaVariable"><span class="hs-identifier hs-type">MetaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RemoteMetaVariable"><span class="hs-identifier hs-type">RemoteMetaVariable</span></a></span><span>
</span><span id="line-133"></span><span id="remoteMetaVariable"><span class="annot"><span class="annottext">remoteMetaVariable :: MetaVariable -&gt; RemoteMetaVariable
</span><a href="Agda.TypeChecking.DeadCode.html#remoteMetaVariable"><span class="hs-identifier hs-var hs-var">remoteMetaVariable</span></a></span></span><span> </span><span id="local-6989586621681118289"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118289"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RemoteMetaVariable"><span class="hs-identifier hs-type">RemoteMetaVariable</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rmvInstantiation :: Instantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#rmvInstantiation"><span class="hs-identifier hs-var">rmvInstantiation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Instantiation
</span><a href="Agda.TypeChecking.DeadCode.html#theInstantiation"><span class="hs-identifier hs-var">theInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118289"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rmvModality :: Modality
</span><a href="Agda.TypeChecking.Monad.Base.html#rmvModality"><span class="hs-identifier hs-var">rmvModality</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118289"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rmvJudgement :: Judgement MetaId
</span><a href="#local-6989586621681118284"><span class="hs-identifier hs-var">rmvJudgement</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621681118289"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-138"></span></pre></body></html>